name: <Detection Name>
id: <optional-unique-guid-or-id>
description: >
  <Short description of the detection logic and what type of suspicious or malicious activity it identifies. 
  Include the behavioral context or threat model.>

author: <Your Name or Team>
version: 1.0
date: <YYYY-MM-DD>
status: production  # Options: production, test, deprecated
severity: Medium    # Options: Informational, Low, Medium, High, Critical

tactics:
  - <Execution | Persistence | Privilege Escalation | Defense Evasion | Credential Access | etc.>

techniques:
  - Txxxx           # e.g. T1059
  - Txxxx.yyy       # e.g. T1059.001

queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0

query: |
  // Import watchlists if needed (e.g., user or device exclusions)
  let ExcludedUsers = (_GetWatchlist('<Watchlist-Name-Users>') | project UserName);
  let ExcludedDevices = (_GetWatchlist('<Watchlist-Name-Devices>') | project DeviceName);

  // Base table
  <DataSourceTable>
  // Core behavioral filters (replace with appropriate fields and values)
  | where <FieldA> == "<value>"                          // E.g., InitiatingProcessFileName == "explorer.exe"
  | where <FieldB> has_any ("<val1>", "<val2>")          // E.g., ProcessCommandLine has_any ("powershell", "cmd")
  | where <FieldC> contains "<keyword>"                  // E.g., for specific tools, IOCs, or parameters
  // Optional scoping to internal tags, device groups, etc.
  | where <ScopeField> contains "<string>"
  // Exclusions
  | where not(AccountName has_any (ExcludedUsers))
  | where not(DeviceName in (ExcludedDevices))
  // Optional case normalization and matching
  | extend LowerCaseField = tolower(<Field>)
  | extend MatchFlag = iff(LowerCaseField has "<keyword>", "Match", "NoMatch")
  // Final output
  | project TimeGenerated, DeviceName, AccountName, FileName, ProcessCommandLine, <...>
  | order by TimeGenerated desc

eventGroupingSettings:
  aggregationKind: AlertPerResult   # Options: AlertPerResult, AlertPerDevice, AlertPerUser, etc.

alertDetailsOverride:
  alertDisplayNameFormat: "<Detection Name or dynamic placeholder>"
  alertDescriptionFormat: >
    <Detailed text that will appear in the Sentinel alert UI. May include dynamic fields.>

customDetails:
  Campaign: "<Optional campaign name>"
  Tactic: "<Primary tactic>"
  Technique: "<MITRE technique ID>"

entityMappings:
  - entityType: Host
    fieldMappings:
      - identifier: FullName
        columnName: DeviceName
  - entityType: Account
    fieldMappings:
      - identifier: Name
        columnName: AccountName

falsePositives:
  - <List known FP scenarios such as admin activity or software behavior>
  - <Mention any tuning options like adjusting scopes or exclusions>

mitreReferences:
  - https://attack.mitre.org/techniques/Txxxx/
  - https://attack.mitre.org/techniques/Txxxx.yyy/

tags:
  - Microsoft Sentinel
  - Behavioral Detection
  - Detection Engineering
  - MITRE ATT&CK
  - Endpoint

requiredDataConnectors:
  - connectorId: MicrosoftThreatProtection
    dataTypes:
      - DeviceProcessEvents

metadata:
  support: community
  license: MIT
  categories:
    - Windows
    - Endpoint
    - Behavioral
